<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>haml-server</title>
  <link rel="stylesheet" href="http://github.com/jashkenas/docco/raw/0.3.0/resources/docco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>haml-server</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-1'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-1">&#182;</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-2'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-2">&#182;</a>
        </div>
        <p><strong>haml-server</strong> is a dead-simple Sinatra app for serving up a directory of
files. There are a few other projects much more ambitious than this (such as
<a href="https://github.com/bernerdschaefer/haml-server">serve</a>), but haml-server&rsquo;s goal is simple: serve haml files. Why? Because
writing <code>HTML</code> is a pain &mdash; especially when you&rsquo;re just putting together a
prototype, or, say, testing out some javascript behavior.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-Installation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Installation">&#182;</a>
        </div>
        <h3>Installation</h3>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-4'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-4">&#182;</a>
        </div>
        <p>This is the easy part! Run this from your default ruby (or default RVM ruby)
so you have access to <code>haml-server</code> from wherever you are.</p>

<pre><code>gem install haml-server
</code></pre>

<p>You can also grab the code from <a href="https://github.com/bernerdschaefer/haml-server">github</a>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-Usage'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Usage">&#182;</a>
        </div>
        <h3>Usage</h3>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-6'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-6">&#182;</a>
        </div>
        <p>Think of <code>haml-server</code> as <code>python -m SimpleHTTPServer</code>&hellip; but for <code>HAML</code>!</p>

<pre><code>haml-server # serves the current directory at localhost:4567
haml-server . # ^ same as above
haml-server -p 8000 sub/dir
</code></pre>

<p>Visiting <code>http://localhost:4567/</code> will render <code>index.haml</code>. Visiting
<code>/path/to/resource</code> will render <code>path/to/resource.haml</code>. Simple.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-Layouts'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Layouts">&#182;</a>
        </div>
        <h4>Layouts</h4>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-8'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-8">&#182;</a>
        </div>
        <p>You can also create a file called &ldquo;layout.haml&rdquo; to apply a layout to each of
your pages:</p>

<pre><code># layout.haml
%html
  %body
    = yield
</code></pre>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-SASS'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-SASS">&#182;</a>
        </div>
        <h4>SASS</h4>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-10'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-10">&#182;</a>
        </div>
        <p>If you want to use SASS templates, you can either define them inline using
HAML&rsquo;s filters, like so:</p>

<pre><code># index.haml
%html
  %head
    :sass
      .content
        width: 10px
</code></pre>

<p>Or you can write them to a standalone file, and then link to the same file
but with &ldquo;.css&rdquo; instead of &ldquo;.sass&rdquo;. So if you had <code>/stylesheets/screen.sass</code>,
then you might do this in your layout:</p>

<pre><code># layout.haml
%html
  %head
    :css
      @import url(/stylesheets/screen.css);
</code></pre>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-The_code'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-The_code">&#182;</a>
        </div>
        <h3>The code</h3>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-12'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-12">&#182;</a>
        </div>
        <p><code>HAML</code>, check!</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nb">require</span> <span class="s2">&quot;haml&quot;</span></pre></div>
      </td>
    </tr>
    <tr id='section-13'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-13">&#182;</a>
        </div>
        <p>Okay. In any other context, this would be pretty evil. Let me explain.
Sinatra is a well-behaving citizen, and calls <code>ARGV.dup</code> before parsing its
options.  Unfortunately for us, that means if we want to easily add
additional arguments, we either have to 1) re-parse <code>ARGV</code> (which would mean
copying the options from <code>sinatra/main.rb</code>) or 2) just redefine <code>ARGV.dup</code>.
Should be clear which one I prefer.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="k">def</span> <span class="nc">ARGV</span><span class="o">.</span><span class="nf">dup</span>
  <span class="nb">self</span>
<span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-14'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-14">&#182;</a>
        </div>
        <p>Yep. This is a hack, too. Sinatra only automatically runs itself when the
file is directly called &mdash; but that&rsquo;s not the case when running through
rubygem&rsquo;s wrapped command. Solution? Just pretend we were executed directly.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="vg">$0</span> <span class="o">=</span> <span class="bp">__FILE__</span></pre></div>
      </td>
    </tr>
    <tr id='section-15'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-15">&#182;</a>
        </div>
        <p>And now we can load sinatra, knowing that the options will be parsed out of
<code>ARGV</code> and the server will start automatically.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nb">require</span> <span class="s2">&quot;sinatra&quot;</span></pre></div>
      </td>
    </tr>
    <tr id='section-16'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-16">&#182;</a>
        </div>
        <p>I love Pathname. This line works just like you&rsquo;d expect it to:</p>

<pre><code>Pathname("/data/foo") + "." # =&gt; /data/foo
Pathname("/data/foo") + "../" # =&gt; /data
Pathname("/data/foo") + "/data" # =&gt; /data
</code></pre>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nb">require</span> <span class="s2">&quot;pathname&quot;</span>

<span class="n">template_dir</span> <span class="o">=</span> <span class="no">Pathname</span><span class="p">(</span><span class="no">Dir</span><span class="o">.</span><span class="n">pwd</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="no">ARGV</span><span class="o">.</span><span class="n">shift</span> <span class="o">||</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>

<span class="n">set</span> <span class="ss">:public</span><span class="p">,</span> <span class="n">template_dir</span>
<span class="n">set</span> <span class="ss">:views</span> <span class="p">,</span> <span class="n">template_dir</span></pre></div>
      </td>
    </tr>
    <tr id='section-17'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-17">&#182;</a>
        </div>
        <p>If a favicon wasn&rsquo;t already matched by the public handler, just return a 404.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">get</span> <span class="s2">&quot;/favicon.ico&quot;</span> <span class="k">do</span>
  <span class="mi">404</span>
<span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-18'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-18">&#182;</a>
        </div>
        <p>This is our basic handler for all requests that come through to Sinatra.
We&rsquo;ll extract the necessary path information, and then render either a haml
or sass file.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">handler</span> <span class="o">=</span> <span class="nb">lambda</span> <span class="k">do</span>
  <span class="n">path</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">path_info</span>

  <span class="n">extension</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">extname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></pre></div>
      </td>
    </tr>
    <tr id='section-19'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-19">&#182;</a>
        </div>
        <p>This is the most straight-forward way to remove the extension from a while
while preserving it&rsquo;s original path information.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">chomp</span><span class="p">(</span><span class="n">extension</span><span class="p">)</span></pre></div>
      </td>
    </tr>
    <tr id='section-20'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-20">&#182;</a>
        </div>
        <p>If the path is empty, it&rsquo;s a request for the index page.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">path</span> <span class="o">=</span> <span class="ss">:index</span> <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="s2">&quot;/&quot;</span></pre></div>
      </td>
    </tr>
    <tr id='section-21'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-21">&#182;</a>
        </div>
        <p>We&rsquo;re rendering templates, so we need to convert to a symbol for Sinatra &mdash;
otherwise it will think we&rsquo;re rending a string.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">to_sym</span>

  <span class="k">case</span> <span class="n">extension</span>
  <span class="k">when</span> <span class="s2">&quot;.css&quot;</span></pre></div>
      </td>
    </tr>
    <tr id='section-22'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-22">&#182;</a>
        </div>
        <p>If a request for, say, &lsquo;/stylesheets/screen.css&rsquo; wasn&rsquo;t matched by the
public handler, then we try to render a sass template with the same name.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="n">sass</span> <span class="n">path</span>
  <span class="k">else</span></pre></div>
      </td>
    </tr>
    <tr id='section-23'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-23">&#182;</a>
        </div>
        <p>Otherwise, we fall back to always rendering haml.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="n">haml</span> <span class="n">path</span>
  <span class="k">end</span>
<span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-24'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-24">&#182;</a>
        </div>
        <p>Now we bind our handler to all of the <code>HTTP</code> verbs. Matching against <code>//</code> is
shorthand for matching all request paths: since <code>//</code> always returns true when
matched against a string, our handler will run on every request. We could
also write <code>get %r{/(.*)}, &amp;handler</code>.. but that just looks ugly!</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">get</span><span class="sr">    //, &amp;handler</span>
<span class="sr">put    /</span><span class="o">/</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">handler</span>
<span class="n">post</span><span class="sr">   //, &amp;handler</span>
<span class="sr">delete /</span><span class="o">/</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">handler</span></pre></div>
      </td>
    </tr>
    <tr id='section-25'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-25">&#182;</a>
        </div>
        <p>And that&rsquo;s it! We let Sinatra handle the rest: it will parse out any provided
options (see <code>haml-server -h</code>) and then run the server for us.</p>

      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
  </table>
</div>
</body>
